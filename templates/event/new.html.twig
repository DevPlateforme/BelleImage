{% extends 'base.html.twig' %}

{% block title %}Hello EventController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>


 <form id = 'myForm' method='post'>

   <label>Nom de l'évenement</label>

      <input id='eventName' type = 'text' name = 'eventName'  onkeyup= 'initErrorMsg()'>
       
       </br>

   <label>Code de l'évènement</label>

      <input id='eventCode' type='text' name='eventCode'  onkeyup= 'initErrorMsg()' >

      </br>

   <input type='submit' name='createEvent' value = "créer l'évènement" onclick='checkNewEvent(event)'>

 </form>

 <div id='nameErrorMsg' style='color:red'></div>

 <div id='codeErrorMsg' style='color:red'></div>


{% endblock %}



{%block javascripts%}


<script>



var eventCode = document.getElementById('eventCode');

var eventName = document.getElementById('eventName');

var myForm = document.getElementById('myForm');

var nameErrorMsg = document.getElementById('nameErrorMsg');

var codeErrorMsg = document.getElementById('codeErrorMsg');






function checkNewEvent(event){

   event.preventDefault();
          

           
    xrq = new XMLHttpRequest();

    xrq.onload = function(){

     var nameValidity = JSON.parse(this.responseText).validName;


    var codeValidity = JSON.parse(this.responseText).validCode;


   console.log("name :" + JSON.parse(this.responseText).validName);

      console.log("code: " + JSON.parse(this.responseText).validCode);




    if( (nameValidity == true) && (codeValidity == true) ){
                  myForm.submit();

    }

    if(nameValidity == false){

        console.log('name false');

        nameErrorMsg.innerHTML = 'Vous avez déjà attribué ce nom à un autre évènement';


    }
    
    if (codeValidity == false){
      
        console.log('code false');

        codeErrorMsg.innerHTML = 'Vous avez déjà attribué ce code à un autre évènement';


    }
  }

  xrq.open('POST', '{{ path("checkValidityOfEventPath") }}',true);

  xrq.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');


   xrq.send("eventCode=" + eventCode.value + '&eventName=' + eventName.value);

}



function initErrorMsg(){

  codeErrorMsg.innerHTML = '';
  nameErrorMsg.innerHTML = '';
}


</script>

{%endblock%}
